<div class="data-entry-container">
  <div class="stages-container">
    <app-data-entry-stage 
      title="Select Form"
    >
      <div class="form-selection-stage">
        <app-form-selector (formSelected)="p.handleFormSelection($event)"></app-form-selector>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      title="Choose Input Method" 
      *ngIf="p.selectedForm !== null"
    >
      <div class="input-method-stage">
        <app-input-type-selector (inputTypeSelected)="p.handleInputTypeSelection($event)"></app-input-type-selector>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      [title]="p.selectedInputType.name || ''" 
      *ngIf="p.selectedInputType !== null && p.selectedInputType.id !== 'manual'"
    >
      <div class="data-entry-stage">
        <ng-container [ngSwitch]="p.selectedInputType.id">
          <div *ngSwitchCase="'image'" class="image-input-stage">
            <app-image-loader (imageLoaded)="p.handleImageLoaded($event)"></app-image-loader>
          </div>
          
          <div *ngSwitchCase="'camera'" class="camera-input-stage">
            <app-camera-capture (photoTaken)="p.handlePhotoTaken($event)"></app-camera-capture>
          </div>
          
          <div *ngSwitchCase="'audio'" class="audio-stage-content">
            <p>Record audio to extract information automatically.</p>
            <div class="audio-placeholder">
              <span class="audio-icon">ðŸŽ¤</span>
              <span class="audio-text">Click to start recording</span>
            </div>
          </div>
          
          <div *ngSwitchDefault class="placeholder-content">
            <p>Please select an input method to continue.</p>
          </div>
        </ng-container>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="Choose Processing Method" 
      *ngIf="(p.uploadedImage !== null || p.capturedPhoto !== null) && (p.selectedInputType?.id === 'image' || p.selectedInputType?.id === 'camera')"
    >
      <div class="process-method-stage">
        <p>Select how you want to process the image:</p>
        <app-image-process-method (methodSelected)="p.handleProcessMethodSelected($event)"></app-image-process-method>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="Transform Image to Text" 
      *ngIf="p.selectedProcessMethod !== null && (p.uploadedImage !== null || p.capturedPhoto !== null) && (p.selectedInputType?.id === 'image' || p.selectedInputType?.id === 'camera')"
    >
      <div class="image-processing-stage">
        <app-ocr-image-processor 
          [imageFile]="p.uploadedImage || p.capturedPhoto" 
          [processingMethod]="p.selectedProcessMethod.id || ''"
          (textExtracted)="p.handleTextExtracted($event)"
        ></app-ocr-image-processor>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="Parse Malaria Data" 
      *ngIf="p.extractedText !== ''"
    >
      <div class="malaria-parser-stage">
        <app-malaria-parser 
          [extractedText]="p.extractedText"
          (dataParsed)="p.handleParsedData($event)"
        ></app-malaria-parser>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      [title]="p.selectedInputType?.id === 'manual' ? 'Fill Form' : 'Edit Parsed Data'"
      *ngIf="p.formData !== null"
    >
      <div class="review-stage-content">
        <p *ngIf="p.selectedInputType?.id === 'manual'">Fill out the form with patient information.</p>
        <p *ngIf="p.selectedInputType?.id !== 'manual'">Review and edit the extracted information before submission.</p>
        <app-malaria-form 
          [malariaData]="p.formData"
          (dataUpdated)="p.handleFormSubmission($event)"
        ></app-malaria-form>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      title="Submit Data" 
      *ngIf="p.formData !== null"
    >
      <div class="submit-stage-content">
        <p>Review your data and submit to the backend system.</p>
        <app-backend-data-sender 
          [payload]="p.formData"
        ></app-backend-data-sender>
      </div>
    </app-data-entry-stage>
  </div>
</div>