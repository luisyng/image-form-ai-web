<div class="data-entry-container">
  <div class="stages-container">
    <app-data-entry-stage 
      title="Select Form"
    >
      <div class="form-selection-stage">
        <app-selector 
        [options]="availableForms"
        [selectedOption]="p.selectedForm"
        (optionSelected)="p.handleFormSelection($event)"></app-selector>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      title="Choose Input Type" 
      *ngIf="p.selectedForm !== null"
    >
      <div class="input-type-stage">
        <app-selector 
        [options]="availableInputTypes"
        [selectedOption]="p.selectedInputType"
        (optionSelected)="handleInputTypeSelection($event)"></app-selector>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      title="Choose Input Method" 
      *ngIf="p.selectedInputType !== null && p.selectedInputType.id !== 'manual'"
    >
      <div class="input-method-stage">
        <app-selector 
        [options]="availableInputMethods"
        [selectedOption]="p.selectedInputMethod"
        (optionSelected)="p.handleInputMethodSelection($event)"></app-selector>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      [title]="p.selectedInputMethod.name || ''" 
      *ngIf="p.selectedInputMethod !== null"
    >
      <div class="data-entry-stage">
        <ng-container [ngSwitch]="p.selectedInputMethod.id">
          <div *ngSwitchCase="'upload-photo'" class="image-input-stage">
            <app-image-loader (imageLoaded)="p.handleImageLoaded($event)"></app-image-loader>
          </div>
          
          <div *ngSwitchCase="'camera'" class="camera-input-stage">
            <app-camera-capture (photoTaken)="p.handlePhotoTaken($event)"></app-camera-capture>
          </div>
          
          <div *ngSwitchCase="'microphone'" class="audio-stage-content">
            <p>Record audio to extract information automatically.</p>
            <div class="audio-placeholder">
              <span class="audio-icon">ðŸŽ¤</span>
              <span class="audio-text">Click to start recording</span>
            </div>
          </div>
          
          <div *ngSwitchCase="'upload-audio'" class="audio-stage-content">
            <p>Upload an audio file to extract information automatically.</p>
            <div class="audio-placeholder">
              <span class="audio-icon">ðŸ”Š</span>
              <span class="audio-text">Click to upload audio</span>
            </div>
          </div>
          
          <div *ngSwitchDefault class="placeholder-content">
            <p>Please select an input method to continue.</p>
          </div>
        </ng-container>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="Choose Processing Method" 
      *ngIf="p.isPhotoEntry() && p.hasImage()"
    >
      <div class="process-method-stage">
        <p>Select how you want to process the image:</p>
        <app-image-process-method (methodSelected)="p.handleProcessMethodSelected($event)"></app-image-process-method>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="AI Analysis" 
      *ngIf="p.selectedProcessMethod?.id === 'llm' && p.isPhotoEntry() && p.hasImage()"
    >
      <div class="llm-processing-stage">
        <app-llm-processor 
          [imageFile]="p.photo" 
          (dataParsed)="p.handleParsedData($event)"
        ></app-llm-processor>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="Transform Image to Text" 
      *ngIf="p.selectedProcessMethod?.id === 'ocr' && p.isPhotoEntry() && p.hasImage()"
    >
      <div class="image-processing-stage">
        <app-ocr-image-processor 
          [imageFile]="p.photo" 
          [processingMethod]="p.selectedProcessMethod?.id || ''"
          (textExtracted)="p.handleTextExtracted($event)"
        ></app-ocr-image-processor>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      title="Parse Malaria Data" 
      *ngIf="p.extractedText !== ''"
    >
      <div class="malaria-parser-stage">
        <app-malaria-parser 
          [extractedText]="p.extractedText"
          (dataParsed)="p.handleParsedData($event)"
        ></app-malaria-parser>
      </div>
    </app-data-entry-stage>
    
    <app-data-entry-stage 
      [title]="p.isManualEntry() ? 'Fill Form' : 'Edit Parsed Data'"
      *ngIf="p.formData !== null"
    >
      <div class="review-stage-content">
        <p *ngIf="p.isManualEntry()">Fill out the form with patient information.</p>
        <p *ngIf="!p.isManualEntry()">Review and edit the extracted information before submission.</p>
        <app-malaria-form 
          [malariaData]="p.formData"
          (dataUpdated)="p.handleFormSubmission($event)"
        ></app-malaria-form>
      </div>
    </app-data-entry-stage>

    <app-data-entry-stage 
      title="Submit Data" 
      *ngIf="p.formData !== null"
    >
      <div class="submit-stage-content">
        <p>Review your data and submit to the backend system.</p>
        <app-backend-data-sender 
          [payload]="p.formData"
        ></app-backend-data-sender>
      </div>
    </app-data-entry-stage>
  </div>
</div>